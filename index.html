<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chik Chok | AI Code Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    .dark-mode {
      background-color: #1f2937;
      color: white;
    }
    .card-dark {
      background-color: #374151;
    }
    .gradient-bg {
      background: linear-gradient(to right, #667eea, #764ba2);
    }
    .glass-card {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body class="transition duration-300 ease-in-out gradient-bg min-h-screen text-white">

  <div class="max-w-5xl mx-auto p-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-4xl font-extrabold drop-shadow-xl">Chik Chok | AI Code Generator</h1>
      <button onclick="toggleTheme()" class="px-4 py-2 bg-white text-indigo-700 rounded-full shadow-lg hover:scale-105 transition">Toggle Theme</button>
    </div>

    <!-- Lottie Animation -->
    <div class="flex justify-center mb-8">
      <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_jcikwtux.json" background="transparent" speed="1" style="width: 200px; height: 200px;" loop autoplay></lottie-player>
    </div>

    <!-- Code Generator Form -->
    <div class="glass-card rounded-xl shadow-xl p-6 mb-10">
      <h2 class="text-2xl font-semibold mb-4">Generate Code</h2>
      <select id="languageSelect" class="mb-4 p-2 bg-white bg-opacity-10 text-white rounded">
        <option value="java">Java</option>
        <option value="kotlin">Kotlin</option>
        <option value="xml">XML</option>
      </select>
      <input type="text" id="apiKey" class="mb-4 p-2 w-full bg-white bg-opacity-10 text-white rounded" placeholder="Enter your OpenAI API key">
      <small class="block mb-4 text-sm">Get your API key from <a href="https://platform.openai.com/account/api-keys" target="_blank" class="underline">here</a></small>
      <textarea id="userPrompt" class="w-full p-4 border-none rounded mb-4 bg-white bg-opacity-10 text-white placeholder-gray-300" rows="4" placeholder="مثلاً: یه کلاس بساز که کاربر رو با ایمیل و رمز ثبت‌نام کنه"></textarea>
      <button onclick="generateCode()" class="bg-green-500 hover:bg-green-400 px-6 py-2 text-white font-bold rounded-lg shadow-md transition-all">Generate</button>
    </div>

    <!-- Code Output -->
    <div id="codeOutput" class="space-y-8"></div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-2 rounded shadow-lg hidden z-50">Copied to clipboard!</div>

    <!-- Footer -->
    <footer class="text-center mt-20 text-white text-sm opacity-70">
      © 2025 Chik Chok | All rights reserved
    </footer>
  </div>

  <script type="module">
    import { Configuration, OpenAIApi } from 'https://cdn.jsdelivr.net/npm/openai@latest/dist/index.js';

    // Auto dark mode based on system time
    window.addEventListener("DOMContentLoaded", () => {
      const hour = new Date().getHours();
      if (hour >= 19 || hour < 6) {
        document.body.classList.add("dark-mode");
      }
    });

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
    }

    function showToast() {
      const toast = document.getElementById("toast");
      toast.classList.remove("hidden");
      setTimeout(() => toast.classList.add("hidden"), 2000);
    }

    function copyToClipboard(code) {
      navigator.clipboard.writeText(code).then(showToast);
    }

    function downloadCode(code, language) {
      const blob = new Blob([code], { type: 'text/plain' });
      const a = document.createElement('a');
      const fileExt = language === 'java' ? '.java' : language === 'kotlin' ? '.kt' : '.xml';
      a.href = URL.createObjectURL(blob);
      a.download = `chikchok_code${fileExt}`;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    async function generateCode() {
      const apiKey = document.getElementById("apiKey").value.trim();
      if (!apiKey) return alert("Please enter your OpenAI API key");

      const language = document.getElementById("languageSelect").value;
      const promptText = document.getElementById("userPrompt").value.trim();
      if (!promptText) return alert("Please enter your prompt");

      const configuration = new Configuration({
        apiKey: apiKey,
        dangerouslyAllowBrowser: true
      });
      const openai = new OpenAIApi(configuration);

      try {
        const completion = await openai.createChatCompletion({
          model: "gpt-3.5-turbo",
          messages: [
            { role: "user", content: `Generate ${language} code for: ${promptText}` }
          ],
          temperature: 0.5,
          max_tokens: 500
        });

        const generatedCode = completion.data.choices[0].message.content.trim();
        const output = document.getElementById("codeOutput");

        const card = document.createElement("div");
        card.className = "glass-card p-6 rounded-2xl shadow-xl border border-white/20 relative";

        const title = document.createElement("h3");
        title.className = "text-xl font-bold mb-3";
        title.innerText = `Generated ${language.charAt(0).toUpperCase() + language.slice(1)} Code`;

        const pre = document.createElement("pre");
        pre.className = "overflow-auto bg-black/80 text-green-300 p-4 rounded-xl font-mono whitespace-pre-wrap mb-4";
        pre.innerText = generatedCode;
        pre.onclick = () => copyToClipboard(generatedCode);

        const btnContainer = document.createElement("div");
        btnContainer.className = "flex gap-4";

        const copyBtn = document.createElement("button");
        copyBtn.innerText = "Copy";
        copyBtn.className = "bg-indigo-500 hover:bg-indigo-400 text-white px-4 py-2 rounded-lg transition font-bold";
        copyBtn.onclick = () => copyToClipboard(generatedCode);

        const downloadBtn = document.createElement("button");
        downloadBtn.innerText = "Download";
        downloadBtn.className = "bg-emerald-500 hover:bg-emerald-400 text-white px-4 py-2 rounded-lg transition font-bold";
        downloadBtn.onclick = () => downloadCode(generatedCode, language);

        btnContainer.appendChild(copyBtn);
        btnContainer.appendChild(downloadBtn);

        card.appendChild(title);
        card.appendChild(pre);
        card.appendChild(btnContainer);
        output.prepend(card);
      } catch (error) {
        alert("Error generating code: " + error.message);
      }
    }
  </script>
</body>
</html>
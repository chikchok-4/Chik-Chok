<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chik Chok | GitHub Code Search</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #0f172a;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
    }
    .glass {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .neon {
      background-color: #3b82f6;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: bold;
      color: white;
      box-shadow: 0 0 10px #3b82f6;
      transition: transform 0.2s ease;
    }
    .neon:hover {
      transform: scale(1.05);
    }
    pre {
      background: #1e293b;
      padding: 1rem;
      border-radius: 0.75rem;
      white-space: pre-wrap;
      overflow-x: auto;
      font-size: 0.9rem;
    }
  </style>
</head>
<body class="p-6 max-w-5xl mx-auto">
  <h1 class="text-3xl font-bold mb-6 text-center">Chik Chok | GitHub Code Finder</h1>

  <div class="glass">
    <input id="searchInput" type="text" placeholder="مثلاً: login activity" class="w-full mb-4 p-2 rounded bg-white/10 border border-white/20 text-white">
    
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
      <select id="languageSelect" class="p-2 rounded bg-white/10 border border-white/20 text-white">
        <option value="">همه زبان‌ها</option>
        <option value="java">Java</option>
        <option value="kotlin">Kotlin</option>
        <option value="xml">XML</option>
      </select>
      
      <select id="resultCount" class="p-2 rounded bg-white/10 border border-white/20 text-white">
        <option value="5">5 نتیجه</option>
        <option value="10">10 نتیجه</option>
        <option value="20">20 نتیجه</option>
        <option value="30">30 نتیجه</option>
      </select>

      <button onclick="searchCode()" class="neon w-full col-span-2 md:col-span-1">جستجو در GitHub</button>
    </div>
  </div>

  <div id="results"></div>

  <script>
    async function searchCode() {
      const query = document.getElementById("searchInput").value.trim();
      const lang = document.getElementById("languageSelect").value;
      const count = parseInt(document.getElementById("resultCount").value);

      if (!query) return alert("لطفاً یک عبارت برای جستجو وارد کن");

      const resultsBox = document.getElementById("results");
      resultsBox.innerHTML = '<p class="text-center text-sm text-gray-400">در حال جستجو در GitHub...</p>';

      let searchQuery = `${encodeURIComponent(query)}+in:file`;
      if (lang) {
        searchQuery += `+language:${lang}`;
      }

      const url = `https://api.github.com/search/code?q=${searchQuery}&per_page=${count}`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (!data.items || data.items.length === 0) {
          resultsBox.innerHTML = '<p class="text-center text-red-400">نتیجه‌ای یافت نشد.</p>';
          return;
        }

        resultsBox.innerHTML = "";
        for (const item of data.items) {
          const fileRes = await fetch(item.url, {
            headers: { Accept: "application/vnd.github.v3.raw" }
          });
          const code = await fileRes.text();

          const card = document.createElement("div");
          card.className = "glass";

          const title = document.createElement("h3");
          title.className = "font-bold mb-2";
          title.textContent = `${item.name} (${item.repository.full_name})`;

          const pre = document.createElement("pre");
          pre.textContent = code;

          const btns = document.createElement("div");
          btns.className = "mt-2 flex flex-wrap gap-2";

          const copyBtn = document.createElement("button");
          copyBtn.textContent = "کپی کد";
          copyBtn.className = "neon";
          copyBtn.onclick = () => navigator.clipboard.writeText(code);

          const dlBtn = document.createElement("button");
          dlBtn.textContent = "دانلود";
          dlBtn.className = "neon";
          dlBtn.onclick = () => {
            const blob = new Blob([code], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = item.name;
            a.click();
          };

          btns.appendChild(copyBtn);
          btns.appendChild(dlBtn);

          card.appendChild(title);
          card.appendChild(pre);
          card.appendChild(btns);
          resultsBox.appendChild(card);
        }
      } catch (err) {
        console.error(err);
        resultsBox.innerHTML = '<p class="text-red-500">خطا در دریافت داده از GitHub</p>';
      }
    }
  </script>
</body>
</html>